version: "3.9"

services:
  api:
    build:
      # ğŸ”´ ì¤‘ìš”: ë¹Œë“œ ì»¨í…ìŠ¤íŠ¸ëŠ” "í”„ë¡œì íŠ¸ ë£¨íŠ¸"
      context: ../../..     # backend/efk/application/build ê¸°ì¤€ 3ë‹¨ê³„ ìƒìœ„ â†’ ë£¨íŠ¸
      # Dockerfileì€ í˜„ì¬ íŒŒì¼(efk/application/build)ì— ìˆëŠ” ê±¸ ì‚¬ìš©
      dockerfile: backend/efk/build/Dockerfile
      args:
        SRC_DIR: backend/efk/application/src
    environment:
      APP_MODULE: ${APP_MODULE:-main:app}
      HOST: 0.0.0.0
      PORT: "8000"
      LOG_LEVEL: info
      TZ: Asia/Seoul
    ports:
      - "8000:8000"
    labels:
      app: "efk-fastapi"
      env: "prod"
      team: "platform"
      component: "api"
      project: "efk-test"
    # ğŸ”¹ Fluentd ë“œë¼ì´ë²„ + ë¼ë²¨ ì „ë‹¬
    logging:
      driver: fluentd
      options:
        fluentd-address: "host.docker.internal:24224"  # ë§¥/ìœˆë„ìš°
        tag: "stack.api.{{.Name}}.{{.ID}}"
        labels: "app,env"
        env: "HOST,PORT,LOG_LEVEL"
        fluentd-async: "true"          # ë¹„ë™ê¸° ì „ì†¡(ê¶Œì¥)
        # fluentd-verify-connection: "false"  # ìˆ˜ì‹ ê¸° ëŠ¦ê²Œ ë– ë„ ì»¨í…Œì´ë„ˆ ë¨¼ì € ëœ¨ê²Œ
