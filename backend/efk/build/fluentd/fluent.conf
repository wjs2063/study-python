# ~/fluentd/fluent.conf (호스트에 저장; 컨테이너에 마운트)
<source>
  @type forward
  port 24224
  bind 0.0.0.0
</source>

# 라벨(app=efk*)만 통과 (필요 시 유지)
<filter **>
  @type grep
  <regexp>
    key app
    pattern ^efk
  </regexp>
</filter>

<match **>
  @type mongo
  host 172.30.1.71                # ← 같은 네트워크에 있는 Mongo 컨테이너라면 서비스명 사용
  port 27017
  database test
  collection test_collection

  # 인증
  user root
  password example
  auth_source admin

  include_tag_key true
  tag_key tag

  <buffer>
    @type file
    path /fluentd/buffer/mongo   # ← 컨테이너 내부 쓰기 가능한 경로
    flush_interval 5s
    chunk_limit_size 5m
    total_limit_size 1g
    retry_forever true
  </buffer>
</match>