# ~/fluentd/fluent.conf
<source>
  @type forward
  port 24224
  bind 0.0.0.0
</source>

# 라벨(app=fastapi)만 통과시키고 싶다면:
<filter **>
  @type grep
  <regexp>
    key app
    pattern ^efk # efk로 시작하는 라벨만 필터링
  </regexp>
</filter>

<match **>
  @type mongo
  host 127.0.0.1
  port 27017
  database test
  collection test_collection

  #인증 정보
  user root
  password example
  auth_source admin        # 계정을 admin DB에 만들었으면 admin, 특정 DB면 그 DB명

  include_tag_key true
  tag_key tag


  # 네트워크 장애시 버퍼파일
  <buffer>
    @type file
    path /usr/local/var/fluentd/buffer/mongo
    flush_interval 5s
    chunk_limit_size 5m
    total_limit_size 1g
    retry_forever true
  </buffer>
</match>